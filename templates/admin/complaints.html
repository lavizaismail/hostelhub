{% extends 'base.html' %}
{% block title %}All Complaints - HostelHub{% endblock %}

{% block content %}
<div class="page-header">
  <h1 class="page-title animate__animated animate__fadeInDown">ðŸ”§ All System Complaints</h1>
  <a href="{{ url_for('admin.export_complaints') }}" class="btn btn-success">ðŸ“¥ Export to CSV</a>
</div>

<div class="filter-section">
  <form method="get" class="filter-form">
    <label for="status">Status:</label>
    <select name="status" id="status" onchange="this.form.submit()">
      <option value="">All</option>
      <option value="open" {% if request.args.get('status') == 'open' %}selected{% endif %}>Open</option>
      <option value="assigned" {% if request.args.get('status') == 'assigned' %}selected{% endif %}>Assigned</option>
      <option value="in_progress" {% if request.args.get('status') == 'in_progress' %}selected{% endif %}>In Progress</option>
      <option value="resolved" {% if request.args.get('status') == 'resolved' %}selected{% endif %}>Resolved</option>
      <option value="closed" {% if request.args.get('status') == 'closed' %}selected{% endif %}>Closed</option>
    </select>

    <label for="priority">Priority:</label>
    <select name="priority" id="priority" onchange="this.form.submit()">
      <option value="">All</option>
      <option value="low" {% if request.args.get('priority') == 'low' %}selected{% endif %}>Low</option>
      <option value="medium" {% if request.args.get('priority') == 'medium' %}selected{% endif %}>Medium</option>
      <option value="high" {% if request.args.get('priority') == 'high' %}selected{% endif %}>High</option>
      <option value="urgent" {% if request.args.get('priority') == 'urgent' %}selected{% endif %}>Urgent</option>
    </select>
  </form>
</div>

{% if complaints %}
<table class="table animate__animated animate__fadeInUp">
  <thead>
    <tr>
      <th>ID</th>
      <th>Title</th>
      <th>Student</th>
      <th>Category</th>
      <th>Status</th>
      <th>Priority</th>
      <th>Created</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {% for c in complaints %}
    <tr>
      <td>#{{ c.complaintid }}</td>
      <td>{{ c.title }}</td>
      <td>{{ c.student.fullname }}</td>
      <td><span class="badge badge-info">{{ c.category | capitalize }}</span></td>
      <td><span class="badge badge-{{ 'success' if c.status == 'resolved' else 'warning' }}">{{ c.status | capitalize }}</span></td>
      <td><span class="badge badge-{{ 'danger' if c.priority == 'urgent' else 'secondary' }}">{{ c.priority | capitalize }}</span></td>
      <td>{{ c.created_at.strftime('%d-%m-%Y') if c.created_at else '' }}</td>
      <td><a href="{{ url_for('admin.complaint_detail', complaint_id=c.complaintid) }}" class="btn btn-primary btn-sm">View</a></td>
    </tr>
    {% endfor %}
  </tbody>
</table>
{% else %}
<p class="text-center mt-4">No complaints found.</p>
{% endif %}
{% endblock %}

{% block extra_css %}
<style>
.page-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 2rem;
  flex-wrap: wrap;
  gap: 1rem;
}

.filter-section {
  background: var(--surface-color);
  padding: 1.5rem;
  border-radius: 12px;
  margin-bottom: 2rem;
  box-shadow: 0 4px 20px var(--shadow);
}

.filter-form {
  display: flex;
  gap: 1rem;
  align-items: center;
  flex-wrap: wrap;
}

.filter-form label {
  font-weight: 600;
}

.filter-form select {
  padding: 0.5rem 1rem;
  border: 2px solid var(--border-color);
  border-radius: 8px;
  background: var(--surface-color);
  color: var(--text-color);
}

.badge {
  padding: 0.4rem 0.8rem;
  border-radius: 12px;
  font-size: 0.85rem;
  font-weight: 600;
}

.badge-info { background: var(--info-color); color: white; }
.badge-success { background: var(--success-color); color: white; }
.badge-warning { background: var(--warning-color); color: white; }
.badge-danger { background: var(--danger-color); color: white; }
.badge-secondary { background: var(--secondary-color); color: white; }
</style>
{% endblock %}
